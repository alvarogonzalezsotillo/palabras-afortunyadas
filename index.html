<!DOCTYPE html>
<html>
    <head>
        <title>prueba-worker</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    </head>
    <body>

        <div id="ui">
            <input id="palabra" type="text" name="palabra" value="" placeholder="Anagrama" />
            <input id="botonPalabra" type="button" value="Busca anagramas"  disabled="true"/>
        </div>    

        <div id="uifrase">
            <input id="frase" type="text" name="frase" value="" placeholder="Frase" />
            <input id="botonFrase" type="button" value="Busca anagramas en la frase"  disabled="true"/>
        </div>    

        
        <div id="output">
        </div>

        
        <script type="text/javascript">
         function log(msg){
             console.log(msg);
             e("output").innerHTML += ("<pre>" + msg + "</pre>");
         }
         function e(id){
             return document.getElementById(id);
         }
         let visibleFromScala = {}
         log( "Cargando corpus...");
         visibleFromScala.worker = new Worker("./palabras/js/src/main/js/prueba-worker.js");

         visibleFromScala.worker.onmessage = function(msg){
             let m = msg.data
             if( m == "Corpus cargado" ){
                 //e("botonFrase").disabled = false;
                 e("botonPalabra").disabled = false;
                 e("output").innerHTML = "";
                 log( "Corpus cargado");
             }
             else{
                 e("botonPalabra").disabled = false;
                 e("botonPalabra").value = "Busca anagramas";
                 
                 log( "Se han econtrado " + m.length + " coincidencias"  );
                 for( let i = 0 ; i < m.length ; i++ ){
                     log( "  " + m[i] );
                 }
             }
         };
         
         function enviar(p){
             log( "EnvÃ­o palabra: " + p );
             setTimeout( () => visibleFromScala.worker.postMessage(p), 1 );
         }
         
         e("botonPalabra").onclick = function(){
             e("botonPalabra").disabled = true;
             e("botonPalabra").value = "Buscando...";
             let palabra = e("palabra").value;
             e("output").innerHTML = "";
             enviar(palabra);
         }
         
        </script>

    </body>
</html>
